---
layout: post
keywords: 
description: 
title: Python ElementTree解析XML
categories: [Python]
tags: [Python, xml, ElementTree]
group: archive
icon: code
featured: false
---

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Python ElementTree解析XML</a>
<ul>
<li><a href="#sec-1-1">1.1 导入模块</a></li>
<li><a href="#sec-1-2">1.2 ElementTree对象和Element对象</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1 ElementTree对象</a></li>
<li><a href="#sec-1-2-2">1.2.2 Element对象</a></li>
</ul>
</li>
<li><a href="#sec-1-3">1.3 解析</a></li>
<li><a href="#sec-1-4">1.4 创建xml</a>
<ul>
<li><a href="#sec-1-4-1">1.4.1 父子节点的操作</a></li>
<li><a href="#sec-1-4-2">1.4.2 操作节点属性attrib</a></li>
<li><a href="#sec-1-4-3">1.4.3 Text属性</a></li>
<li><a href="#sec-1-4-4">1.4.4 节点对象与字符串之间的转换</a></li>
<li><a href="#sec-1-4-5">1.4.5 xml的美化输出</a></li>
<li><a href="#sec-1-4-6">1.4.6 生成xml</a></li>
</ul>
</li>
<li><a href="#sec-1-5">1.5 查找子节点</a>
<ul>
<li><a href="#sec-1-5-1">1.5.1 常用函数</a></li>
<li><a href="#sec-1-5-2">1.5.2 XPATH语法</a></li>
</ul>
</li>
<li><a href="#sec-1-6">1.6 一个完整的创建xml的例子</a></li>
<li><a href="#sec-1-7">1.7 参考资料</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Python ElementTree解析XML</h2>
<div class="outline-text-2" id="text-1">

<p>XML是一种分级的数据形式，所以最自然的表示方法是将它表示为一棵树。ElementTree有两个对象来实现这个目的 － ElementTree将整个XML解析为一棵树，Element将单个结点解析为树。如果是整个文档级别的操作(比如说读，写，找到一些有趣的节点)通常用 ElementTree 。单个XML节点和它的子节点通常用Element
</p>
</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1">导入模块</h3>
<div class="outline-text-3" id="text-1-1">




<pre class="example">import xml.etree.ElementTree as ET
</pre>

</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2">ElementTree对象和Element对象</h3>
<div class="outline-text-3" id="text-1-2">


</div>

<div id="outline-container-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">ElementTree对象</h4>
<div class="outline-text-4" id="text-1-2-1">

<p>tree=ET.parse(文件或xml字符串)，返回的对象是整个文档的对象tree
</p></div>

</div>

<div id="outline-container-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">Element对象</h4>
<div class="outline-text-4" id="text-1-2-2">

<p>表示xml节点，ElementTree调用函数的返回值通常是Element对象
</p>
<p>
描述Element对象的属性：
</p>
<p>
&lt;branch name="testing" hash="1cdf045c"&gt;something&lt;/branch&gt;
</p>
<p>
tag:tag值 branch
</p>
<p>
text:文本属性 something
</p>
<p>
attrib:节点属性，通常为字典类型 {'hash': '1cdf045c', 'name': 'testing'}
</p></div>
</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3">解析</h3>
<div class="outline-text-3" id="text-1-3">

<p>示例xml，test.xml
</p>


<pre class="example">&lt;?xml version="1.0"?&gt;
&lt;doc&gt;
  &lt;branch1 name="one" num="001"&gt;
     beijing
  &lt;/branch1&gt;
  &lt;branch2 name="two" num="002"&gt;
    &lt;sub-branch2 name="twenty-one"&gt;
      heibei
    &lt;/sub-branch2&gt;
  &lt;/branch2&gt;
  &lt;branch3&gt;shanghai&lt;/branch3&gt;
&lt;/doc&gt;
</pre>


<pre class="example">#导入模块
import xml.etree.ElementTree as ET
#获取ElementTree对象
tree = ET.parse(r"/home/wchunx/test.xml")
#获取根节点
root = tree.getroot()
#如果解析xml格式的字符串，用fromstring()函数
&gt;&gt;&gt; ET.fromstring("&lt;root&gt;&lt;item&gt;One&lt;/item&gt;&lt;item&gt;Two&lt;/item&gt;&lt;item&gt;Three&lt;/item&gt;&lt;/root&gt;")
#直接获取到根节点
&lt;Element 'root' at 0xb6bcd6cc&gt;
#一个节点的字节点形成一个列表，访问根节点的子节点
&gt;&gt;&gt; for i in range(0, len(root)):
...     print root[i].tag, root[i].text, root[i].attrib
... 
branch1 
     beijing
   {'num': '001', 'name': 'one'}
branch2 
     {'num': '002', 'name': 'two'}
branch3 shanghai {}
#iter()方法可以节点进行深度遍历，遍历所有节点，包括自己，返回一个迭代器对象
&gt;&gt;&gt; for elem in root.iter():
...     print elem.tag,elem.attrib
... 
doc {}
branch1 {'num': '001', 'name': 'one'}
branch2 {'num': '002', 'name': 'two'}
sub-branch2 {'name': 'twenty-one'}
branch3 {}
#iter()，遍历有指定标签的节点
&gt;&gt;&gt; for elem in root.iter(tag='branch2'):
...     print elem.tag, elem.attrib     
... 
branch2 {'num': '002', 'name': 'two'}
&gt;&gt;&gt; 
#删除节点,两种方法
&gt;&gt;&gt;root.remove(root[0])
&gt;&gt;&gt;del root[1]

&gt;&gt;&gt; for elem in root:
...     print elem
... 
&lt;Element 'branch2' at 0xb6b5c5ac&gt;
#删除某节点下的所有子节点
&gt;&gt;&gt; root[0].clear()
</pre>

</div>

</div>

<div id="outline-container-1-4" class="outline-3">
<h3 id="sec-1-4">创建xml</h3>
<div class="outline-text-3" id="text-1-4">




<pre class="example">#创建节点，用Element()函数。创建root节点，指定tag为root
root = ET.Element('root')
#创建子节点，父节点为root.创建节点，添加到root下两步。
a = ET.Element('one')
root.append(a)
#SubElement()函数专门用来创建子节点
b = ET.SubElement(root, 'two')
c = ET.SubElement(root, 'three')
d = ET.SubElement(c, 'four')
#节点同样支持切片操作，以及append,insert,remove方法
nodes = root[0:2]
root.remove(a)
root.insert(0, a)
#append,insert,remove的参数是节点而非tag,element is None查看节点存在，len(element)查看子节点数量
</pre>


</div>

<div id="outline-container-1-4-1" class="outline-4">
<h4 id="sec-1-4-1">父子节点的操作</h4>
<div class="outline-text-4" id="text-1-4-1">

<p>节点没有指向父节点的指针，如果涉及到父子节点的联系，最好通过操作父节点
</p>
<p>
root.getchildren()获取root的直接子节点a,b,c的列表。
</p>
<p>
for elem in root 遍历root的直接子节点a,b,c
</p>
<p>
root.getiterator()获取root和其下层全部子节点root,a,b,c,d的列表
</p>


<pre class="example">#清晰列出父子节点的关系
&gt;&gt;&gt; for parent in root.getiterator():
...     for child in parent:
...             print (parent, child)
... 
(&lt;Element 'root' at 0xb72541cc&gt;, &lt;Element 'one' at 0xb725c18c&gt;)
(&lt;Element 'root' at 0xb72541cc&gt;, &lt;Element 'two' at 0xb6b1adac&gt;)
(&lt;Element 'root' at 0xb72541cc&gt;, &lt;Element 'three' at 0xb6b1e36c&gt;)
(&lt;Element 'three' at 0xb6b1e36c&gt;, &lt;Element 'four' at 0xb6b1ad2c&gt;)
#建立父子节点的映射关系
&gt;&gt;&gt; parent_map=dict((c,p) for p in root.getiterator() for c in p)
&gt;&gt;&gt; parent_map
{&lt;Element 'one' at 0xb725c18c&gt;: &lt;Element 'root' at 0xb72541cc&gt;, &lt;Element 'two' at 0xb6b1adac&gt;: &lt;Element 'root' at 0xb72541cc&gt;, &lt;Element 'four' at 0xb6b1ad2c&gt;: &lt;Element 'three' at 0xb6b1e36c&gt;, &lt;Element 'three' at 0xb6b1e36c&gt;: &lt;Element 'root' at 0xb72541cc&gt;}
</pre>

</div>

</div>

<div id="outline-container-1-4-2" class="outline-4">
<h4 id="sec-1-4-2">操作节点属性attrib</h4>
<div class="outline-text-4" id="text-1-4-2">

<p>节点属性通常存储在一个字典中，可以用.attrib来访问
</p>


<pre class="example">#注意定义方式first = '1',不能写成'first' = '1'
e = ET.SubElement(root, 'five', first = '1', second = '2')
#可以通过attrib.get,attrib.keys和attrib.items以及set方法来操作attribute
#获取'first'的值
print e.attrib.get('first')
1
#上步的简写形式
print e.get('first')
1
#键值列表（简写）
print e.keys()
['second', 'first']
print e.items()
[('second', '2'), ('first', '1')]
#'third'不存在
print elem.get('third')
None
print elem.get('third','default')
default
#添加数据
elem.set('third','3')
print elem.get('third','default')
3
</pre>

</div>

</div>

<div id="outline-container-1-4-3" class="outline-4">
<h4 id="sec-1-4-3">Text属性</h4>
<div class="outline-text-4" id="text-1-4-3">

<p>保存附加信息,通常为一个字符串,如果不添加text，通常默认是None或空字符串
</p>


<pre class="example">&gt;&gt;&gt; f = ET.SubElement(e, 'six' ,ni = 'hello')
&gt;&gt;&gt; f.text = 'sample'
</pre>

</div>

</div>

<div id="outline-container-1-4-4" class="outline-4">
<h4 id="sec-1-4-4">节点对象与字符串之间的转换</h4>
<div class="outline-text-4" id="text-1-4-4">




<pre class="example">#字符串转化为Element，可以用XML()或fromstring()
text = "&lt;title font='large'&gt;A sample text window&lt;/title&gt;"
elem = ET.XML(text)
el = ET.fromstring(text)
#Element转化为字符串
text=et.tostring(elem)
'&lt;title font="large"&gt;A sample text window&lt;/title&gt;'
</pre>

</div>

</div>

<div id="outline-container-1-4-5" class="outline-4">
<h4 id="sec-1-4-5">xml的美化输出</h4>
<div class="outline-text-4" id="text-1-4-5">

<p>write函数输出的xml是紧凑的，美化输出可以使用indent函数，接受的参数为Element对象。
</p>


<pre class="example">def indent(elem, level=0):
    i = "\n" + level*"  "
    if len(elem):
        if not elem.text or not elem.text.strip():
            elem.text = i + "  "
        if not elem.tail or not elem.tail.strip():
            elem.tail = i
        for elem in elem:
            indent(elem, level+1)
        if not elem.tail or not elem.tail.strip():
            elem.tail = i
    else:
        if level and (not elem.tail or not elem.tail.strip()):
            elem.tail = i
</pre>

</div>

</div>

<div id="outline-container-1-4-6" class="outline-4">
<h4 id="sec-1-4-6">生成xml</h4>
<div class="outline-text-4" id="text-1-4-6">




<pre class="example">#dump用于将element打印到标准输出，This function should be used for debugging only.
&gt;&gt;&gt; ET.dump(root)
&lt;root&gt;&lt;one /&gt;&lt;two /&gt;&lt;three&gt;&lt;four /&gt;&lt;/three&gt;&lt;five first="1" second="2" third="3"&gt;&lt;six ni="hello"&gt;sample&lt;/six&gt;&lt;/five&gt;&lt;/root&gt;
#ElementTree()方法由Element对象获取tree对象，tree对象的write()方法将xml内容写到文件或标准输出
&gt;&gt;&gt; tree = ET.ElementTree(root)
&gt;&gt;&gt; tree.write('good.xml')
&gt;&gt;&gt; import sys
&gt;&gt;&gt; tree.write(sys.stdout)
</pre>

</div>
</div>

</div>

<div id="outline-container-1-5" class="outline-3">
<h3 id="sec-1-5">查找子节点</h3>
<div class="outline-text-3" id="text-1-5">




<pre class="example">&gt;&gt;&gt; indent(root)
&gt;&gt;&gt; ET.dump(root)
&lt;root&gt;
  &lt;one /&gt;
  &lt;two /&gt;
  &lt;three&gt;
    &lt;four /&gt;
  &lt;/three&gt;
  &lt;five first="1" second="2" third="3"&gt;
    &lt;six ni="hello"&gt;sample&lt;/six&gt;
  &lt;/five&gt;
&lt;/root&gt;
</pre>


</div>

<div id="outline-container-1-5-1" class="outline-4">
<h4 id="sec-1-5-1">常用函数</h4>
<div class="outline-text-4" id="text-1-5-1">

<p>find相关函数查找范围是一级子节点，iter查找包含当前节点在内的整个subtree
</p>
<p>
find(pattern)返回第一个匹配的子节点，找不到则返回None
</p>
<p>
findtext(pattern) 返回第一个匹配的子节点的text值
</p>
<p>
findall(pattern) 返回匹配的全部子节点的列表
</p>
<p>
pattern可以为一个标识:只匹配表层子节点，或使用XPath：可以在整个tree进行更准确的搜索
</p>
<p>
getiterator(tag) 返回所有指定tag的节点列表
</p>
<p>
getiterator()方法可以按深度优先顺序遍历整个tree，返回包含当前节点在内的所有节点的列表
</p>
<p>
getchildren() 返回当前节点的所有一级子节点组成的列表
</p></div>

</div>

<div id="outline-container-1-5-2" class="outline-4">
<h4 id="sec-1-5-2">XPATH语法</h4>
<div class="outline-text-4" id="text-1-5-2">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">语法</th><th scope="col" class="left">含义</th></tr>
</thead>
<tbody>
<tr><td class="left">tag</td><td class="left">搜索匹配给定tag的子节点。devices/graphic搜索所有devices的子节点下匹配graphic的孙子节点</td></tr>
<tr><td class="left">*</td><td class="left">所有子节点。*/graphic所搜所有子节点下，匹配graphic的孙子节点</td></tr>
<tr><td class="left">.</td><td class="left">搜索当前节点，通常用于表示相对路径</td></tr>
<tr><td class="left">//</td><td class="left">所搜当前节点下的所有级别子节点，.//egg搜索当前节点下所有级别匹配egg的节点</td></tr>
<tr><td class="left">..</td><td class="left">搜索父节点</td></tr>
<tr><td class="left">[@attrib]</td><td class="left">搜索含有attrib属性的节点。root.find(".//five[@first]")</td></tr>
<tr><td class="left">[@attrib='value']</td><td class="left">搜索所有节点中attrib属性值为“value”的节点 root.find(".//five[@first='1']")</td></tr>
<tr><td class="left">[tag]</td><td class="left">精确匹配tag</td></tr>
<tr><td class="left">[position]</td><td class="left">搜索处于指定位置的节点 position可以为数字(1为第一个)，last()(代表最后一个)或与last()的相对位置，例如last()-1表示倒数第二个位置</td></tr>
</tbody>
</table>

</div>
</div>

</div>

<div id="outline-container-1-6" class="outline-3">
<h3 id="sec-1-6">一个完整的创建xml的例子</h3>
<div class="outline-text-3" id="text-1-6">




<pre class="example">import xml.etree.ElementTree as ET
root = ET.Element('html')
head = ET.SubElement(root,'head')
title = ET.SubElement(head,'title')
title.text = 'Page Title'
body = ET.SubElement(root,'body')
body.set('bgcolor','#ffffff')
body.text = 'Hello,world'
def indent(elem, level=0):
    i = "\n" + level*"  "
    if len(elem):
        if not elem.text or not elem.text.strip():
            elem.text = i + "  "
        if not elem.tail or not elem.tail.strip():
            elem.tail = i
        for elem in elem:
            indent(elem, level+1)
        if not elem.tail or not elem.tail.strip():
            elem.tail = i
    else:
        if level and (not elem.tail or not elem.tail.strip()):
            elem.tail = i
indent(root)
tree=ET.ElementTree(root)
tree.write('no.xml')
import sys
tree.write(sys.stdout)
</pre>

</div>

</div>

<div id="outline-container-1-7" class="outline-3">
<h3 id="sec-1-7">参考资料</h3>
<div class="outline-text-3" id="text-1-7">

<p><a href="http://effbot.org/zone/element.htm">Elements and Element Trees</a>
</p>
<p>
<a href="http://docs.python.org/2.7/">Python v2.7.5 documentation</a>
</p>
<p>
<a href="http://kb.cnblogs.com/page/190321/">http://kb.cnblogs.com/page/190321/</a>
</p>
<p>
<a href="http://www.cnblogs.com/ifantastic/archive/2013/04/12/3017110.html">http://www.cnblogs.com/ifantastic/archive/2013/04/12/3017110.html</a>
</p></div>
</div>
</div>
