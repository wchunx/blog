---
layout: post
keywords: 
description: 
title: django学习笔记 
categories: [django]
tags: [django, python, openstack]
group: archive
icon: code
featured: false
---


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 学习资料</a></li>
<li><a href="#sec-2">2 安装</a>
<ul>
<li><a href="#sec-2-1">2.1 创建一个项目</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1 创建项目mysqite</a></li>
<li><a href="#sec-2-1-2">2.1.2 启动服务</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3">3 视图和URL</a>
<ul>
<li><a href="#sec-3-1">3.1 demo</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1 views.py</a></li>
<li><a href="#sec-3-1-2">3.1.2 urls.py</a></li>
<li><a href="#sec-3-1-3">3.1.3 常用到的正则表达式</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2 django处理请求的工作机制</a></li>
<li><a href="#sec-3-3">3.3 更进一步：动态url</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">学习资料</h2>
<div class="outline-text-2" id="text-1">

<p><a href="http://djangobook.py3k.cn/2.0/">The Django Book</a> <br/>
<a href="http://www.cnblogs.com/BeginMan/category/458761.html">Django入门</a> <br/>
<a href="http://www.w3school.com.cn/index.html">w3school</a> <br/>
<a href="https://github.com/gnemoug/ComPerformance">ComPerformance</a>
</p></div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">安装</h2>
<div class="outline-text-2" id="text-2">

<p>ubuntu上
</p>


<pre class="example">sudo apt-get intall python-django
#验证
&gt;&gt;&gt; import django
&gt;&gt;&gt; django.VERSION
(1, 3, 1, 'final', 0)
</pre>


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1">创建一个项目</h3>
<div class="outline-text-3" id="text-2-1">


</div>

<div id="outline-container-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">创建项目mysqite</h4>
<div class="outline-text-4" id="text-2-1-1">




<pre class="example">django-admin startproject mysite
</pre>

<p>
mysite下包含:
</p></div>

</div>

<div id="outline-container-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">启动服务</h4>
<div class="outline-text-4" id="text-2-1-2">

<p>mysite下
</p>


<pre class="example">python manage.py runserver
</pre>

<p>
这将会在端口8000启动一个本地服务器,浏览器访问 <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>, 可以看到django欢迎页面。
更改主机端口
</p>


<pre class="example">python manage.py runserver 8080
#让django监听所有的网络接口，因此其他电脑就能连接到。
python manage.py runserver 0.0.0.0:8000
</pre>

</div>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">视图和URL</h2>
<div class="outline-text-2" id="text-3">

<p>views.py(视图):导入声明，定义视图函数. <br/>
urls.py(URLconf):URLconf就像是Django所支撑网站的目录。它的本质是URL模式以及要为该URL模式调用的视图函数之间的映射表。用来告诉django某个url调用那个视图函数。
</p>
</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1">demo</h3>
<div class="outline-text-3" id="text-3-1">


</div>

<div id="outline-container-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">views.py</h4>
<div class="outline-text-4" id="text-3-1-1">

<p>mysite目录下创建views.py
</p>


<pre class="example"># -*- coding: utf-8 -*-

#从django.http模块中导入HttpResponse类
from django.http import HttpResponse
import datetime

def hello(request):
    return HttpResponse("Hello world")

def current_datetime(request):
    now=datetime.datetime.now()
    html="&lt;html&gt;&lt;body&gt;现在时刻：%s.&lt;/body&gt;&lt;/html&gt;" %now
    return HttpResponse(html)

def my_homepage_view(request):
    return HttpResponse("nothing")
</pre>

<ol>
<li>HttpResponse类位于django.http模块中,需要导入
</li>
<li>(views.py)视图中每一个函数称作视图函数,每个视图函数至少包含一个参数,即request,这是一个触发这个视图、包含当前Web请求信息的对象，是类django.http.HttpRequest的一个实例.
</li>
<li>在每一个视图(views)都需要实例化、处理、返回HttpResponse对象
</li>
</ol>

<p>一般情况下，创建一个HttpResponse时，以字符串的形式传递页面内容给HttpResponse构造函数。
</p></div>

</div>

<div id="outline-container-3-1-2" class="outline-4">
<h4 id="sec-3-1-2">urls.py</h4>
<div class="outline-text-4" id="text-3-1-2">

<p>url就像一座桥梁，通过这个桥梁我们才找到视图中对应的代码，渲染的模板（暂时没有用到模板），而这一切都通过URLConf(即urls.py)，在我们django-admin startproject mysite后，该脚本会自动建立一份URLConf（即urls.py文件），我们可以在settings.py中找到它的真身，如下：
</p>


<pre class="example">...
ROOT_URLCONF = 'mysite.urls'
...
</pre>

<p>
urls.py打开如下
</p>


<pre class="example">from django.conf.urls.defaults import * #[1]

# Uncomment the next two lines to enable the admin:
# from django.contrib import admin
# admin.autodiscover()

urlpatterns = patterns('',    #[2]
    # Example:
    # (r'^mysite/', include('mysite.foo.urls')),

    # Uncomment the admin/doc line below and add 'django.contrib.admindocs'
    # to INSTALLED_APPS to enable admin documentation:
    # (r'^admin/doc/', include('django.contrib.admindocs.urls')),

    # Uncomment the next line to enable the admin:
    # (r'^admin/', include(admin.site.urls)),
)
</pre>

<ol>
<li>从django.conf.urls.defaults导入所有模块，它们是Django URLconf的基本构造,其中包括了一个叫做patterns的函数
</li>
<li>patterns()函数将处理结果保存到urlpatterns变量中,patterns函数当前只有一个参数—一个空的字符串
</li>
</ol>

<p>编辑该文件以展示hello和current_datetime视图
</p>


<pre class="example">from django.conf.urls.defaults import *
from mysite.views import hello, current_datetime, my_homepage_view

urlpatterns = patterns('',
    ('^hello/$', hello),
    (r'^time/$',current_datetime),
    ('^$', my_homepage_view),
)
</pre>

<ol>
<li>patterns函数中的参数其实就是一个元祖，元组第一个元素是一个正则表达式，后边是对应的视图函数
</li>
<li>在浏览器中通过输入<a href="http://127.0.0.1:8000/time">http://127.0.0.1:8000/time</a> ，Django在URLconf中的所有URL模式中，查找第一个匹配/time/的条目。如果匹配成功，则视图函数返回一个HttpResponse，调用current_datetime这个视图函数，Django转换HttpResponse为一个适合的HTTP response， 以Web page显示出来，(在没有模板定义的情况下)显示输出结果。
</li>
<li>Django在检查URL模式前，移除每一个申请的URL开头的斜杠(<i>)。这意味着我们为/hello/写URL模式不用包含前面的斜杠(</i>);任何不匹配或尾部没有斜杠(/)的申请URL，将被重定向至尾部包含斜杠的相同字眼的URL。（这是受配置文件setting中APPEND_SLASH项控制的.
</li>
<li>访问<a href="http://127.0.0.1:8000/time">http://127.0.0.1:8000/time</a> 会发现时间是不对的，那是因为django的时区设置有问题，修改setting.py的时区,TIME_ZONE = "Asia/Shanghai"
</li>
</ol>

</div>

</div>

<div id="outline-container-3-1-3" class="outline-4">
<h4 id="sec-3-1-3">常用到的正则表达式</h4>
<div class="outline-text-4" id="text-3-1-3">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">符号</th><th scope="col" class="left">匹配</th></tr>
</thead>
<tbody>
<tr><td class="left">.(dot)</td><td class="left">任意单个字符</td></tr>
<tr><td class="left">\d</td><td class="left">任意一位数字</td></tr>
<tr><td class="left">[A-Z]</td><td class="left">A 到 Z中任意一个字符（大写）</td></tr>
<tr><td class="left">[a-z]</td><td class="left">a 到 z中任意一个字符（小写）</td></tr>
<tr><td class="left">[A-Za-z]</td><td class="left">a 到 z中任意一个字符（不区分大小写）</td></tr>
<tr><td class="left">+</td><td class="left">匹配一个或更多 (例如, \d+ 匹配一个或 多个数字字符)</td></tr>
<tr><td class="left">[^/]+</td><td class="left">一个或多个不为'/'的字符</td></tr>
<tr><td class="left">?</td><td class="left">零个或一个之前的表达式（例如：\d? 匹配零个或一个数字）</td></tr>
<tr><td class="left">*</td><td class="left">匹配0个或更多 (例如, \d* 匹配0个 或更多数字字符)</td></tr>
<tr><td class="left">{1,3}</td><td class="left">介于一个和三个（包含）之前的表达式（例如，\d{1,3}匹配一个或两个或三个数字）</td></tr>
</tbody>
</table>

</div>
</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2">django处理请求的工作机制</h3>
<div class="outline-text-3" id="text-3-2">

<ol>
<li>用manage.py runserver 启动Django服务器时就载入了在同一目录下的settings.py。该文件包含了项目中的配置信息，如前面将的URLConf等，其中最重要的配置就是ROOT_URLCONF，它告诉Django哪个Python模块应该用作本站的URLConf,默认的是urls.py
</li>
<li>当访问url的时候，Django会根据ROOT_URLCONF的设置来装载URLConf。
</li>
<li>然后按顺序逐个匹配URLConf里的URLpatterns。如果找到则会调用相关联的视图函数，并把HttpRequest对象作为第一个参数(通常是request)
</li>
<li>最后该view函数负责返回一个HttpResponse对象，
</li>
</ol>


<img src ="/images/2013-12/django_work.png"/>
</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3">更进一步：动态url</h3>
<div class="outline-text-3" id="text-3-3">

<p>接下来深入一下url的映射，实现动态的url。
</p>
<p>
我们要做到就是在url后输入一些参数，从而实现不同的调用内容（如在url后输入数字(小时)来显示当前时间累加后的时间，如当前时间是6:20,在浏览器中输入&hellip;.time/plus/3,则显示9:20）的小实例
</p>
<p>
这里使用带通配符的URL匹配模式。本例中用\d+匹配一个或多个数字.
</p>
<p>
urls.py
</p>


<pre class="example">from django.conf.urls.defaults import *
from mysite.views import current_datetime, hours_ahead

urlpatterns = patterns('',
    (r'^time/$', current_datetime),
    (r'^time/plus/(\d+)/$',hours_ahead), #[1]不加()会报错
#    (r'^time/plus/(\d{1,2})/$', hours_ahead), #限制最大99
)
</pre>

<ol>
<li>我们想要把这些数字作为参数，用圆括号把\d+或\d{1,2}包围起来,正则表达式也是用圆括号来从文本里提取数据的
</li>
</ol>

<p>views.py
</p>


<pre class="example"># -*- coding: utf-8 -*-

#从django.http模块中导入HttpResponse类
from django.http import HttpResponse
import datetime

def current_datetime(request):
    now=datetime.datetime.now()
    html="&lt;html&gt;&lt;body&gt;现在时刻：%s.&lt;/body&gt;&lt;/html&gt;" %now
    return HttpResponse(html)

def hours_ahead(request,offset): #[1]
    try:
        offset=int(offset)
    except ValueError:
        raise Http404()
    dt=datetime.datetime.now()+datetime.timedelta(hours=offset)
    html="&lt;html&gt;&lt;body&gt;In %s hours it will be %s.&lt;/body&gt;&lt;/html&gt;" %(offset,dt)
    return HttpResponse(html)
</pre>

<ol>
<li>hours_ahead有两个参数,offset是从匹配的URL中提取出来的.注意：捕获值永远都是字符串（string）类型，而不会是整数（integer）类型,这个函数做的第一件事就是将字符串转换为整数。如果在一个不能转换为整数的值上调用int()，pyhon将抛出ValueError异常，最终显示404页面.
</li>
</ol>

<p>test
</p></div>
</div>
</div>
